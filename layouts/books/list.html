{{ define "main" }}

{{ if eq .RelPermalink (printf "/%s/" .Section) }}
    <div class="books-container">
        <div class="books-header">
            <h1 class="books-title">ğŸ“š {{ .Title }}</h1>
            <div class="books-subtitle">{{ .Content }}</div>
        </div>
        
        {{ $pages := .Pages }}
        {{ if $pages }}
        <div class="books-grid">
            {{ range $pages }}
            <article class="book-card">
                <a href="{{ .Permalink }}" class="book-link">
                    <div class="book-cover-wrapper">
                        {{ if .Params.cover }}
                            {{ with .Resources.GetMatch .Params.cover }}
                                <img src="{{ .RelPermalink }}" alt="{{ $.Title }}" class="book-cover" loading="lazy">
                            {{ else }}
                                <div class="book-fallback">
                                    <span class="book-fallback-icon">ğŸ“–</span>
                                    <span class="book-fallback-title">{{ .Title }}</span>
                                </div>
                            {{ end }}
                        {{ else }}
                            <div class="book-fallback">
                                <span class="book-fallback-icon">ğŸ“–</span>
                                <span class="book-fallback-title">{{ .Title }}</span>
                            </div>
                        {{ end }}
                    </div>
                    <div class="book-info">
                        <h2 class="book-title">{{ .Title }}</h2>
                        <div class="book-meta">
                            {{ with .Params.book_author }}
                            <div class="book-meta-item">
                                <span class="meta-label">ä½œè€…</span>{{ . }}
                            </div>
                            {{ end }}
                            {{ with .Params.year }}
                            <div class="book-meta-item">
                                <span class="meta-label">å‡ºç‰ˆå¹´</span>{{ . }}
                            </div>
                            {{ end }}
                        </div>
                    </div>
                </a>
            </article>
            {{ end }}
        </div>
        {{ else }}
        <div class="empty-state">
            <div class="empty-icon">ğŸ“š</div>
            <h2 class="empty-title">ä¹¦æ¶ç©ºç©ºå¦‚ä¹Ÿ</h2>
            <p class="empty-description">æš‚æ—¶è¿˜æ²¡æœ‰ä½œå“, æ•¬è¯·æœŸå¾…ã€‚</p>
        </div>
        {{ end }}
    </div>

{{ else }}

    {{/* ************************************** */}}
    {{/* ******* è¿™æ˜¯å•æœ¬ä¹¦ç±è¯¦æƒ…å’Œç« èŠ‚å¸ƒå±€ ******* */}}
    {{/* ************************************** */}}
    <div class="book-detail-container">
        <div class="book-detail">
            <div class="book-detail-header">
                <div class="book-cover-section">
                    {{ if .Params.cover }}
                        {{ with .Resources.GetMatch .Params.cover }}
                            <img src="{{ .RelPermalink }}" alt="{{ $.Title }}" class="book-cover-large" loading="lazy">
                        {{ else }}
                            <div class="book-cover-placeholder">
                                <span class="placeholder-icon">ğŸ“–</span>
                            </div>
                        {{ end }}
                    {{ else }}
                        <div class="book-cover-placeholder">
                            <span class="placeholder-icon">ğŸ“–</span>
                        </div>
                    {{ end }}
                </div>
                
                <div class="book-detail-info">
                    <h1 class="book-detail-title">{{ .Title }}</h1>
                    
                    <div class="book-detail-meta">
                        {{ with .Params.book_author }}<div class="detail-meta-item"><span class="detail-meta-label">ä½œè€…</span><span class="detail-meta-value">{{ . }}</span></div>{{ end }}
                        {{ with .Params.translator }}<div class="detail-meta-item"><span class="detail-meta-label">è¯‘è€…</span><span class="detail-meta-value">{{ . }}</span></div>{{ end }}
                        {{ with .Params.publisher }}<div class="detail-meta-item"><span class="detail-meta-label">å‡ºç‰ˆç¤¾</span><span class="detail-meta-value">{{ . }}</span></div>{{ end }}
                        {{ with .Params.year }}<div class="detail-meta-item"><span class="detail-meta-label">å‡ºç‰ˆå¹´</span><span class="detail-meta-value">{{ . }}</span></div>{{ end }}
                        {{ with .Params.pages }}<div class="detail-meta-item"><span class="detail-meta-label">é¡µæ•°</span><span class="detail-meta-value">{{ . }}</span></div>{{ end }}
                        {{ with .Params.isbn }}<div class="detail-meta-item"><span class="detail-meta-label">ISBN</span><span class="detail-meta-value">{{ . }}</span></div>{{ end }}
                    </div>
                    
                    {{ with .Params.summary }}
                    <div class="book-summary">
                        <p>{{ . }}</p>
                    </div>
                    {{ end }}
                </div>
            </div>
            {{ with .Content }}
                <div class="book-content">{{ . }}</div>
            {{ end }}
        </div>

        {{ $chapters := .RegularPages.ByWeight }}
        {{ if $chapters }}
        <div class="chapters-section">
            <h2 class="chapters-title">ç›®å½•</h2>
            <ul class="chapters-list">
                {{ range $chapters }}
                <li class="chapter-item">
                    <a href="{{ .Permalink }}" class="chapter-link">
                        {{ with .Weight }}
                        <span class="chapter-number">ç¬¬ {{ . }} ç« </span>
                        {{ end }}
                        <span class="chapter-title">{{ .Title }}</span>
                        <span class="chapter-arrow">â†’</span>
                    </a>
                </li>
                {{ end }}
            </ul>
        </div>
        {{ end }}
    </div>

{{ end }}

{{ end }}
