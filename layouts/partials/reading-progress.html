<!-- 阅读进度指示器 -->
<div class="reading-progress-container" id="readingProgressContainer">
    <!-- 顶部进度条 -->
    <div class="reading-progress-bar" id="readingProgressBar"></div>

    <!-- 右侧浮动进度指示器 -->
    <div class="reading-progress-indicator" id="readingProgressIndicator">
        <div class="progress-circle">
            <svg class="progress-ring" width="60" height="60">
                <circle class="progress-ring-bg" cx="30" cy="30" r="26" />
                <circle class="progress-ring-fill" cx="30" cy="30" r="26" id="progressCircle" />
            </svg>
            <div class="progress-percent" id="progressPercent">0%</div>
        </div>
        <div class="progress-info">
            <span class="progress-label">阅读进度</span>
        </div>
    </div>
</div>

<style>
/* 阅读进度容器 */
.reading-progress-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 9999;
    pointer-events: none;
}

/* 顶部进度条 */
.reading-progress-bar {
    position: fixed;
    top: 0;
    left: 0;
    height: 4px;
    background: linear-gradient(90deg,
        var(--trans-pink),
        var(--trans-blue),
        var(--trans-pink)
    );
    width: 0%;
    transition: width 0.1s ease-out;
    z-index: 10000;
    box-shadow: 0 2px 8px rgba(245, 169, 184, 0.4);
}

/* 右侧浮动进度指示器 */
.reading-progress-indicator {
    position: fixed;
    right: 2rem;
    bottom: 8rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    opacity: 0;
    transform: translateX(100px);
    transition: all 0.3s ease;
    pointer-events: auto;
}

.reading-progress-indicator.visible {
    opacity: 1;
    transform: translateX(0);
}

/* 进度圆环 */
.progress-circle {
    position: relative;
    width: 60px;
    height: 60px;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 50%;
    box-shadow: 0 4px 15px rgba(245, 169, 184, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.progress-circle:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(245, 169, 184, 0.5);
}

.progress-ring {
    position: absolute;
    top: 0;
    left: 0;
    transform: rotate(-90deg);
}

.progress-ring-bg {
    fill: none;
    stroke: rgba(245, 169, 184, 0.2);
    stroke-width: 3;
}

.progress-ring-fill {
    fill: none;
    stroke: url(#progressGradient);
    stroke-width: 3;
    stroke-linecap: round;
    stroke-dasharray: 163.36; /* 2 * PI * 26 */
    stroke-dashoffset: 163.36;
    transition: stroke-dashoffset 0.3s ease;
}

.progress-percent {
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--trans-pink);
    position: relative;
    z-index: 1;
}

.progress-info {
    background: rgba(255, 255, 255, 0.95);
    padding: 0.4rem 0.8rem;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(245, 169, 184, 0.2);
}

.progress-label {
    font-size: 0.7rem;
    color: var(--trans-blue);
    font-weight: 600;
    white-space: nowrap;
}

/* 移动端优化 */
@media (max-width: 768px) {
    .reading-progress-indicator {
        right: 1rem;
        bottom: 6rem;
        scale: 0.85;
    }

    .progress-info {
        display: none;
    }
}

/* SVG渐变定义 */
svg defs {
    display: none;
}
</style>

<!-- SVG渐变定义 -->
<svg width="0" height="0">
    <defs>
        <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#F5A9B8;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#5BCEFA;stop-opacity:1" />
        </linearGradient>
    </defs>
</svg>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const progressBar = document.getElementById('readingProgressBar');
    const progressIndicator = document.getElementById('readingProgressIndicator');
    const progressCircle = document.getElementById('progressCircle');
    const progressPercent = document.getElementById('progressPercent');

    if (!progressBar || !progressIndicator) return;

    const circumference = 2 * Math.PI * 26; // 圆的周长

    function updateProgress() {
        const windowHeight = window.innerHeight;
        const documentHeight = document.documentElement.scrollHeight;
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

        // 计算进度百分比
        const scrollHeight = documentHeight - windowHeight;
        const scrollPercent = scrollHeight > 0 ? (scrollTop / scrollHeight) * 100 : 0;

        // 更新顶部进度条
        progressBar.style.width = scrollPercent + '%';

        // 更新圆环进度
        const offset = circumference - (scrollPercent / 100) * circumference;
        progressCircle.style.strokeDashoffset = offset;

        // 更新百分比文本
        progressPercent.textContent = Math.round(scrollPercent) + '%';

        // 显示/隐藏进度指示器
        if (scrollTop > 300) {
            progressIndicator.classList.add('visible');
        } else {
            progressIndicator.classList.remove('visible');
        }
    }

    // 点击圆环返回顶部
    progressIndicator.addEventListener('click', function() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });

    // 监听滚动事件
    let ticking = false;
    window.addEventListener('scroll', function() {
        if (!ticking) {
            window.requestAnimationFrame(function() {
                updateProgress();
                ticking = false;
            });
            ticking = true;
        }
    });

    // 初始化
    updateProgress();
});
</script>
